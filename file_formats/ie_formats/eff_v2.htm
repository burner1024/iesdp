<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
<!--  <meta charset="utf-8"> -->
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>EFF file format</title>
  <meta name="description" content="The IESDP (Infinity Engine Structures Description Project) is an effort to research the workings of the Bioware Infinity Engine(R), and act as a collective resource for those interested in such workings.
">

  





  <link rel="stylesheet" href="../../css/main.css">

<!--
  <link rel="canonical" href="https://gibberlings3.github.io/iesdp/file_formats/ie_formats/eff_v2.htm">
  <link rel="alternate" type="application/rss+xml" title="IESDP" href="https://gibberlings3.github.io/iesdp/feed.xml">
-->
</head>


<body>

<header class="site-header">








    <hr />
    <div id="buttonboxtop">
      <div id="buttonstriptop">
        <a href="../../index.htm">Index</a> &nbsp;&bull;&nbsp;
        <a href="../../files/2da/index.htm">2DA</a> &nbsp;&bull;&nbsp;
        <a href="../../opcodes/index.htm">Effects</a> &nbsp;&bull;&nbsp;
        <a href="../../file_formats/index.htm">File Formats</a> &nbsp;&bull;&nbsp;
        <a href="../../scripting/actions/index.htm">Actions</a> &nbsp;&bull;&nbsp;
        <a href="../../files/ids/index.htm">Identifiers</a> &nbsp;&bull;&nbsp;
        <a href="../../scripting/triggers/index.htm">Triggers</a> &nbsp;&bull;&nbsp;
        <a href="../../appendices/index.htm">Appendices</a> &nbsp;&bull;&nbsp;
        <a href="../../site_info/index.htm">Site Info</a> &nbsp;&bull;&nbsp;
        <a href="../../site_info/legal.htm">Legal</a> &nbsp;&bull;&nbsp;
        <a href="https://www.gibberlings3.net/forums/forum/54-iesdp-updates-and-info/" target="_blank">Forum</a>
      </div>
    </div>
    <hr />
    <div id="logo">
      <a href="../../main.htm">
        <img src="../../images/iesdp_logo.gif" alt="IESDP Logo" width="120" height="120" />
      </a>
    </div>

</header>


<div id="nonFooter">
  <div id="content">

    <div class="title_main">EFF file format</div>
    <br />
    <div class="fileHeader">Applies to:</div>
    <div class="indent1">BG1: TotS, BG2, BG2: ToB, IWD, IWD:HoW, IWD:TotL, BGEE</div><br />
    
    <div class="fileHeader">General Description</div>
    <div class="indent1">
      This file format describes an effect (opcode) and its parameters. The format is an extended version of that found embedded in creatures, items and spells, and is a replacement for the version 1 embedded effects used in BG1. The engine appears to roll a probability for each valid target type, rather than one probability per attack.<br />
    </div>
    <br />
    
    <div class="fileHeader"><a name="effv2">EFF V2.0</a></div>
    <div class="indent1">
      Overall structure:<br />
      <div class="indent1">
        <li><a href="#effv2_Header">Header</a>
        <li><a href="#effv2_Body">Body</a></li>
      </div>
      <br />
    </div>
  
    
    
    
    <div class="fileHeader">
  <a name="effv2_Header">EFF V2.0 Header</a>
</div>
<br />
<div class="indent1">
  
  <table border="1" width="98%" class="offset_table">
    <colgroup>
      <col width="5%" />
      <col width="12%" />
      <col width="*" />
    </colgroup>
    <thead>
      <tr>
        <th>Offset</th>
        <th>Size (datatype)</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      



<tr>










  <td>0x0000</td>
  <td>4 (char array)</td>
  <td><p>Signature (‘EFF ‘)</p>
</td>
</tr>



<tr>










  <td>0x0004</td>
  <td>4 (char array)</td>
  <td><p>Version (‘V2.0’)</p>
</td>
</tr>




    </tbody>
  </table>
</div>
<br />


    
    
    
    
    
    <div class="fileHeader">
  <a name="effv2_Body">EFF V2.0 Body</a>
</div>
<br />
<div class="indent1">
  
    When an effect is called via an eff, several of the fields (including duration and timing mode) are overriden by the calling SPL/ITM. Other fields are copied directly from the calling SPL/ITEM and overwrite the values defined in the EFF.<br /><br />
    
  
  <table border="1" width="98%" class="offset_table">
    <colgroup>
      <col width="5%" />
      <col width="12%" />
      <col width="*" />
    </colgroup>
    <thead>
      <tr>
        <th>Offset</th>
        <th>Size (datatype)</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      



<tr>










  <td>0x0008</td>
  <td>4 (char array)</td>
  <td><p>External EFFs - the field is the same as the signature field from the header<br />
Embedded EFFs - this field is zeroed out</p>
</td>
</tr>



<tr>










  <td>0x000c</td>
  <td>4 (char array)</td>
  <td><p>External EFFs - the field is the same as the version field from the header<br />
Embedded EFFs - this field is zeroed out</p>
</td>
</tr>



<tr>










  <td>0x0010</td>
  <td>4 (dword)</td>
  <td><p>Opcode number</p>
</td>
</tr>



<tr>










  <td>0x0014</td>
  <td>4 (dword)</td>
  <td><p>Target type</p>
<ul>
  <li>0=None</li>
  <li>1=Self (pre-projectile)</li>
  <li>2=Pre-target</li>
  <li>3=Party</li>
  <li>4=Everyone (inc. party)</li>
  <li>5=Everyone (excl. party)</li>
  <li>6=Everyone matching specific value of caster (or Party if cast by party member)</li>
  <li>7=Everyone matching specific value of target</li>
  <li>8=Everyone (excl. caster)</li>
  <li>9=Self (post-projectile)</li>
</ul>
</td>
</tr>



<tr>










  <td>0x0018</td>
  <td>4 (dword)</td>
  <td><p>Power</p>
</td>
</tr>



<tr>










  <td>0x001c</td>
  <td>4 (dword)</td>
  <td><p>Parameter 1</p>
</td>
</tr>



<tr>










  <td>0x0020</td>
  <td>4 (dword)</td>
  <td><p>Parameter 2</p>
</td>
</tr>



<tr>










  <td>0x0024</td>
  <td>2 (word)</td>
  <td><p>Timing mode</p>
<ul>
  <li>0=Duration</li>
  <li>1=Permanent</li>
  <li>2=While equipped</li>
  <li>3=Delayed Duration</li>
  <li>4=Delayed</li>
  <li>5=Delayed (transforms to 8)</li>
  <li>6=Duration?</li>
  <li>7=Permanent?</li>
  <li>8=Permanent (unsaved)</li>
  <li>9=Permanent (after Death)</li>
  <li>10=Trigger</li>
  <li>4096=Absolute duration</li>
</ul>

<p>NB. all effects except those with Timing mode ‘9’ are removed by death.</p>
</td>
</tr>



<tr>










  <td>0x0026</td>
  <td>2 (word)</td>
  <td><p><span class="unknown">Timing ?</span></p>
</td>
</tr>



<tr>










  <td>0x0028</td>
  <td>4 (dword)</td>
  <td><p>Duration</p>
</td>
</tr>



<tr>










  <td>0x002c</td>
  <td>2 (word)</td>
  <td><p>Probability 1</p>
</td>
</tr>



<tr>










  <td>0x002e</td>
  <td>2 (word)</td>
  <td><p>Probability 2</p>

<p>Note: The BG1 engine treats probability as a single word, effects are applied in the range 0-probability.<br />
Note: Other engines treat probability as two values, effects are applied in the range probability &lt;= x &lt;= probability.<br />
Probability range is 0-99</p>
</td>
</tr>



<tr>










  <td>0x0030</td>
  <td>8 (resref)</td>
  <td><p>Resource</p>
</td>
</tr>



<tr>










  <td>0x0038</td>
  <td>4 (dword)</td>
  <td><p>Dice Thrown</p>
</td>
</tr>



<tr>










  <td>0x003c</td>
  <td>4 (dword)</td>
  <td><p>Dice Sides</p>
</td>
</tr>



<tr>










  <td>0x0040</td>
  <td>4 (dword)</td>
  <td><p>Saving throw type</p>
<ul>
  <li>bit 0: Spells</li>
  <li>bit 1: Breath</li>
  <li>bit 2: Death</li>
  <li>bit 3: Wands</li>
  <li>bit 4: Polymorph</li>
  <li>bit 10: Ignore primary target – Line AoE projectile doesn’t affect end target (EE only)</li>
  <li>bit 11: Ignore secondary target – Line AoE projectile doesn’t affect bystanders (EE only)</li>
  <li>bit 24: Bypass mirror image (EE/ToBEx only)</li>
  <li>bit 25: EE - ignore difficulty; TobEx - limit effect stacking</li>
  <li>bit 26: TobEx internal (don’t use) - suspend effect application</li>
</ul>

<p>NB. If more than 1 saving throw type is specified, the target rolls against their best save</p>
</td>
</tr>



<tr>










  <td>0x0044</td>
  <td>4 (dword)</td>
  <td><p>Save bonus</p>
</td>
</tr>



<tr>










  <td>0x0048</td>
  <td>4 (dword)</td>
  <td><p>TobEx: Stacking ID. Checked when bit 25 of the Saving Throw Type is set.</p>

<p>If two effects of the same opcode are applied, both have Limit Effect Stacking bit set, and both have the same stacking ID, then the latter applied effect is suspended in application until the former effect expires. Regardless of whether it is applied, the latter effect will expire at the same time that it would expire if it was applied. In other words, the total duration of some non-stacking effect opcode is not extended because more than one copy of the effect was applied.</p>

<p>Stacking IDs are unique to the opcode being applied. To maintain uniqueness of stacking IDs between different mods, one recommendation is to use the higher word of Special as the modder’s Infinity Engine Community Prefix, then use the lower word as an identifying ID. For example, 0x41360001 (‘A6’ 0x0001).</p>
</td>
</tr>



<tr>










  <td>0x004c</td>
  <td>4 (dword)</td>
  <td><p>Primary type (school)</p>
</td>
</tr>



<tr>










  <td>0x0050</td>
  <td>4 (dword)</td>
  <td><p><span class="unknown">Unknown</span></p>
</td>
</tr>



<tr>










  <td>0x0054</td>
  <td>4 (dword)</td>
  <td><p><span class="unknown">Parent resource lowest affected level</span></p>
</td>
</tr>



<tr>










  <td>0x0058</td>
  <td>4 (dword)</td>
  <td><p><span class="unknown">Parent resource highest affected level</span></p>
</td>
</tr>



<tr>










  <td>0x005c</td>
  <td>4 (dword)</td>
  <td><p>Resistance</p>

<p>The default behaviour is that effects cannot be dispelled and ignore resistance.</p>
<ul>
  <li>bit 0: Can be dispelled, affected by resistance</li>
  <li>bit 1: Ignores resistance (when used in combination with bit 0)</li>
</ul>

<p>This can also be presented in the more traditional way:</p>
<ul>
  <li>0=Nonmagical</li>
  <li>1=Can be dispelled/Affected by resistance</li>
  <li>2=Cannot be dispelled/Ignores resistance</li>
  <li>3=Can be dispelled/Ignores resistance</li>
</ul>
</td>
</tr>



<tr>










  <td>0x0060</td>
  <td>4 (dword)</td>
  <td><p>Parameter 3</p>
</td>
</tr>



<tr>










  <td>0x0064</td>
  <td>4 (dword)</td>
  <td><p>Parameter 4</p>
</td>
</tr>



<tr>










  <td>0x0068</td>
  <td>4 (dword)</td>
  <td><p>Parameter 5</p>
</td>
</tr>



<tr>










  <td>0x006c</td>
  <td>4 (dword)</td>
  <td><p>Parameter 6</p>
</td>
</tr>



<tr>










  <td>0x0070</td>
  <td>8 (resref)</td>
  <td><p>Resource 2 (VVC in many effects)</p>
</td>
</tr>



<tr>










  <td>0x0078</td>
  <td>8 (resref)</td>
  <td><p>Resource 3</p>
</td>
</tr>



<tr>










  <td>0x0080</td>
  <td>4 (dword)</td>
  <td><p>Caster X coordinate</p>
</td>
</tr>



<tr>










  <td>0x0084</td>
  <td>4 (dword)</td>
  <td><p>Caster Y coordinate</p>
</td>
</tr>



<tr>










  <td>0x0088</td>
  <td>4 (dword)</td>
  <td><p>Target X coordinate</p>
</td>
</tr>



<tr>










  <td>0x008c</td>
  <td>4 (dword)</td>
  <td><p>Target Y coordinate</p>
</td>
</tr>



<tr>










  <td>0x0090</td>
  <td>4 (dword)</td>
  <td><p><span class="unknown">Parent resource type (0=None, 1=Spell, 2=Item)</span></p>
</td>
</tr>



<tr>










  <td>0x0094</td>
  <td>8 (resref)</td>
  <td><p>Parent resource</p>
</td>
</tr>



<tr>










  <td>0x009c</td>
  <td>4 (dword)</td>
  <td><p><span class="unknown">Parent resource flags (from SPL 0x18 or ITM ext header 0x26)</span></p>
</td>
</tr>



<tr>










  <td>0x00a0</td>
  <td>4 (dword)</td>
  <td><p><span class="unknown">Projectile</span></p>
</td>
</tr>



<tr>










  <td>0x00a4</td>
  <td>4 (dword)</td>
  <td><p><span class="unknown">Parent resource slot</span></p>
</td>
</tr>



<tr>










  <td>0x00a8</td>
  <td>32 (bytes)</td>
  <td><p>Variable</p>
</td>
</tr>



<tr>










  <td>0x00c8</td>
  <td>4 (dword)</td>
  <td><p><span class="unknown">Caster level</span></p>
</td>
</tr>



<tr>










  <td>0x00cc</td>
  <td>4 (dword)</td>
  <td><p><span class="unknown">FirstApply (internal flag)</span></p>
</td>
</tr>



<tr>










  <td>0x00d0</td>
  <td>4 (dword)</td>
  <td><p>Secondary Type</p>
</td>
</tr>



<tr>










  <td>0x00d4</td>
  <td>4*15 (dword)</td>
  <td><p><span class="unknown">Unknown</span></p>
</td>
</tr>




    </tbody>
  </table>
</div>
<br />


  </div>
</div>

<a href="#" class="go-up">
  &nbsp;
</a>


  </div>
</div>

<script>
window.addEventListener("scroll", function(event) {
  var top = window.pageYOffset || document.documentElement.scrollTop;
  var arrow = document.getElementsByClassName("go-up")[0];
  if (top > 100) {
    arrow.style.visibility = "visible";
  } else {
    arrow.style.visibility = "hidden";
  }
});
</script>

<footer class="site-footer">

<div id="footer">
  <hr />

    <form method="get" action="http://www.google.com/search">
      <div style="margin: 0px; padding: 0px; text-align: center">
        <input type="hidden" name="ie" value="UTF-8" />
        <input type="hidden" name="oe" value="UTF-8" />
        <input class="form_text" type="text" name="q" size="30" maxlength="255" value="" />
        <input class="form_button" type="submit" name="btnG" value="Search" />
        <input type="hidden" name="domains" value="https://gibberlings3.github.io/iesdp" />
        <input type="hidden" name="sitesearch" value="https://gibberlings3.github.io/iesdp" />
      </div>
    </form>

  <hr />
</div>

</footer>


</body>
</html>
